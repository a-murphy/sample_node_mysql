language: node_js
node_js:
  - "5.9.0"

services:
  - mysql

env:
  - NODE_ENV=test

build:
    ci:
    # Install the app/test dependencies
    - npm install -g knex eslint
    - npm install knex
    - npm install

    # Prepare the test database
    - mysql -e 'CREATE DATABASE mandrel_test CHARACTER SET=utf8 COLLATE=utf8_unicode_ci;'
    - mysql -e "GRANT SELECT,INSERT,UPDATE,DELETE ON name_test.* TO name@localhost IDENTIFIED BY ''; FLUSH PRIVILEGES;"
    #- cat ./config/knexplus.js
    #- (NODE_ENV=test knex --knexfile ./knexplus.js migrate:latest)
    - (NODE_ENV=test knex --knexfile ./knexfile.js seed:run)

    # Run the tests
    - mkdir -p shippable/testresults
    - npm test
